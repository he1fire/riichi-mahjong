name: Supabase Keep Alive (Zombi Mode)

on:
  schedule:
    # 3일마다 정기적으로 실행 (UTC 기준 0시 0분)
    - cron: '0 0 */3 * *'
  workflow_dispatch: # 버튼을 눌러 수동으로 즉시 실행 가능

jobs:
  ping:
    runs-on: ubuntu-latest
    steps:
      - name: Wake up Supabase via RPC
        run: |
          curl -X POST "${{ secrets.VITE_SUPABASE_URL }}/rest/v1/rpc/supabase_zombi_run" \
          -H "apikey: ${{ secrets.VITE_SUPABASE_KEY }}" \
          -H "Authorization: Bearer ${{ secrets.VITE_SUPABASE_KEY }}" \
          -H "Content-Type: application/json"

      - name: Verify Activity
        run: |
          echo "Supabase RPC 'supabase_zombi_run' executed at $(date)"